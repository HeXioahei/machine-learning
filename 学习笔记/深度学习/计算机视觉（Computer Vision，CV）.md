> B站吴恩达深度学习课程
# CV概述
## CV解决的问题
* 图片分类（Image Classification）
* 目标检测（Object Detection）
* 图片风格迁移（Neural Style Transfer）

## 卷积在处理大图像上的作用
对于一张64×64像素大小的图像，他的数据有64×64×3=12288个（3指的是颜色通道数，RGB三个）。这如果直接用全连接层来处理的话，尚且还能处理得了。

但是如果图片变大，比如1000×1000像素大小，那么，输入数据就有3m个（1m=1000,000），是一个(1, 3m)的矩阵。假设隐藏神经元只有1000个，那么，输入层与隐藏层之间得权重矩阵 w 就是维度为(3m, 1000)大小的矩阵，有3m×1000=3b（1b=1000,000,000）个参数，这是一个很大的数量级，会占用很大的内存。

所以，我们就需要用到卷积来处理大图像。

# 边缘检测
## 有什么作用
边缘检测可以用来识别物体，有垂直边缘检测、水平边缘检测等

例如，一张图片如下：
![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410111615584.png)

* 垂直边缘检测
	![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410111616417.png)
* 水平边缘检测
	![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410111617931.png)

## 如何进行边缘检测呢
### 示例
例如，对于一张6×6的灰度图片，因为它是灰度图片，所以颜色通道数为1，所以，它是一个64×64×1的矩阵。如下图所示：
![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410111622075.png)（图像矩阵）

为了进行图像边缘检测，我们可以构造一个3×3的矩阵，习惯上，我们把它称为过滤器（filter）或者是核（kernel）（也即常说的“卷积核”）。对于垂直边缘检测，我们把卷积核构造如下：
![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410111626240.png)（核矩阵）

可以明显地看出，这个和矩阵的数据分布很具备垂直特征，因此，它可以很好的提取图像的垂直特征，具体怎么提取呢？我们接着往下。

我们对图像矩阵和核矩阵进行卷积运算（Convolution Operation），该运算可以用符号`“*”`表示。根据卷积运算规则：新宽 = （原宽 + 填充×2 - 卷积核边长）/ 步长 + 1，最终将得到一个4×4的矩阵，即4×4的图像。计算过程大致如下：
![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410111634994.png)

依次类推，移动蓝色方块，不断计算出4×4矩阵中所有的值。结果如下：
![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410111636994.png)

### 为什么这样的构造和计算可以检测边缘呢
我们可以用一个极端的例子来说明，如下：
![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410111645891.png)

数值越大的地方就越亮。这么一看就一目了然啦！不过需要注意的是，在这个例子中，核矩阵和图片矩阵的亮度分布是一致的，都是左亮右暗（即左边的数值大，有的数值小），所以结果图片矩阵产生的分界线是亮的（即中间是亮的）。如果核矩阵和图片矩阵的亮度分布是相反的，即一个是左亮右暗，一个是左暗右亮，那么最终分界线是暗线。

## 进一步了解边缘检测
### 边缘过渡
我们沿着上文讲的继续扩充，如下图：
![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410111704268.png)

我们使用左亮右暗的核矩阵，那么，如果原图片从左到右是由亮到暗的过渡的话，中间的分界线就会是亮线，如果是由暗到亮的过渡的话，中间的分界线就会是暗线。如此般来，我们就可以由分界线的亮暗来判断原图片颜色是如何过渡的了。

如果我们不在乎这个颜色过渡的话，可以直接把结果计算为绝对值。

水平检测和垂直检测就是一样的道理了。

还有值得注意的是，垂直检测实现的是水平方向上的分割，水平检测实现的是垂直方向上的分割。

### 不同的过滤器
曾经，CV学者们争议过哪种过滤器是最好的。有一些比较常用的经典的filter。如：
* Sobel Filter
	![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410111718572.png)
	它的优点在于：增加了中间一行的权重，这使得结果的鲁棒性会更高一些（鲁棒性：一个系统或算法在面对输入数据中的扰动、噪声、异常值或设计参数变化时，仍然能够保持其预期功能、性能稳定且结果准确的能力）。
* Scharr Filter
	![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410111722662.png)

当然，我们不一定非要用上面提到的这些过滤器中的参数不可，在后文中，我们将学习到逆向传播算法，它可以通过自学习来不断优化过滤器中的参数，以达到最佳的效果。我们只需先给过滤器中的9个参数初始化，然后让他在训练中不断学习来调整参数即可。

不仅如此，通过反向传播的自学习，我们还可以实现对任何角度的边缘的检测，比如45°、73°等，不一定非要垂直和水平不可。

# Padding（填充）
## padding

从上文可以知道，卷积处理后，图片会缩小，同时，边缘的信息也丢失了，这是一个问题。要如何解决呢？这就要提到padding的作用了。

padding简而言之就是对原图片先进行扩充，在边缘补几层“0”，这样卷积后的图片大小就会和原图片扩充前的大小一样，使边缘信息得到了很好的保存。如下图：

![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410112105023.png)

在这我们可以再次提到一下卷积计算规则：新宽 = （原宽 + 填充×2 - 卷积核边长）/ 步长 + 1（向下取整）

当然，除了保持图片大小不变的作用，padding还有其他作用，这由具体的需求而定。其与后续要学到的步长（stride）等结合起来，可以实现更多的卷积功能。

## Valid and Same convolutions
* valid：不填充，大小会变
* same：填充使得大小不变

# stride（步长）

## stride
简单来说，步长就是卷积核在原图上每次移动所跳过的格数。

# cross-correlation（互相关）
在一些数学教材中，真正的convolution在做卷积计算之前是需要对核矩阵先进行个沿副对角线翻转的。而没有提前翻转的其实叫cross-correlation。但在深度学习的文献中，未翻转的也叫做convolution。

# 三维卷积

在前文中，我们了解了二维卷积，并且了解了padding和stride，接下来，我们来了解一下三维卷积，准备出发！

## 单三维卷积
我们先从单三维卷积开始，前文举的例子是一张灰度图片，颜色通道仅为1，所以就只是二维的一张图片。到如果是一张彩色图片，那么就由3个颜色通道，就是3张二维图片，对应的过滤器也就是3个核矩阵，这样，就变成了三位的。图片和过滤器分别为6×6×3和3×3×3（数字 按顺序分别代表高、宽、通道数）。图像的channels（通道数）和卷积核的chanels必须一样多。而它们做卷积操作后的结果是一张4×4的二维图片，即4×4×1，因为3个通道分别卷积的结果最终需要进行求和合并为一个通道。

![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410112151546.png)

为什么卷积核的通道数要和图像的通道数相等呢？这样有什么意义呢？举个例子就可以豁然开朗了。

如果我们将卷积核的第一张核矩阵设为`[[1,1,1],[0,0,0],[-1,-1,-1]]`，其余的两个都设为`0`，那么实现的功能就是 对图片进行红色垂直边缘检测。

![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410112200460.png)

## 多三维卷积
如果我既想进行垂直边缘检测又想进行水平比边缘检测，甚至想做45°边缘检测，那该怎么办呢？那就要用到多三维卷积了。顾名思义，就是多放置几个卷积核。如下图：

![image.png](https://youki-1330066034.cos.ap-guangzhou.myqcloud.com/machine-learning/202410112207406.png)

这样我们就得到了一个4×4×2的输出立方体。

# 单层卷积网络
对于每一个卷积核，先进行卷积核的运算得到一张矩阵图，然后加上偏差bias（不同卷积核的bias不一样），然后进行relu函数激活，得到一张新的矩阵图。最终将这些矩阵图堆叠成三位立方体。这就是一层卷积网络了。

对于第一层卷积网络，在前向传播中，有公式：
$$z^{[1]}=w^{[1]}a^{[0]}+b^{[1]}$$$$a^{[1]}=g(z^{[1]})$$

